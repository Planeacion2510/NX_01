{% extends 'base.html' %}
{% load static %}

{% block title %}Empleados - Talento Humano{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">

    <!-- ENCABEZADO -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="section-title">
            <i class="bi bi-people-fill"></i> Gesti√≥n de Empleados
        </h1>
        <div class="d-flex gap-2">
            <a href="{% url 'talento_humano:exportar_empleados_excel' %}" class="btn-verde">
                <i class="bi bi-file-earmark-excel"></i> Exportar Excel
            </a>
            <a href="{% url 'talento_humano:crear_empleado' %}" class="btn-amarillo">
                <i class="bi bi-person-plus"></i> Nuevo Empleado
            </a>
        </div>
    </div>

    <!-- ESTAD√çSTICAS -->
    <div class="row mb-4 text-center">
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-header-bar" style="background-color: var(--primary);"></div>
                <div class="card-body">
                    <h5>Total Empleados</h5>
                    <h2>{{ total_empleados|default:0 }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-header-bar" style="background-color: var(--success);"></div>
                <div class="card-body">
                    <h5>Activos</h5>
                    <h2>{{ total_activos|default:0 }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-header-bar" style="background-color: var(--warning);"></div>
                <div class="card-body">
                    <h5>√Åreas</h5>
                    <h2>{{ areas.count|default:0 }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-header-bar" style="background-color: var(--danger);"></div>
                <div class="card-body">
                    <h5>P√°ginas</h5>
                    <h2>{{ empleados.paginator.num_pages|default:1 }}</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- FILTROS -->
    <form method="get" class="card p-3 mb-4 shadow-sm">
        <div class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label">üîç B√∫squeda</label>
                <input type="text" name="busqueda" class="form-control" placeholder="Nombre, documento o cargo..."
                       value="{{ request.GET.busqueda }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">√Årea</label>
                <select name="area" class="form-select">
                    <option value="">Todas</option>
                    {% for area in areas %}
                        <option value="{{ area }}" {% if request.GET.area == area %}selected{% endif %}>{{ area }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Estado</label>
                <select name="estado" class="form-select">
                    <option value="">Todos</option>
                    <option value="activo" {% if request.GET.estado == 'activo' %}selected{% endif %}>Activo</option>
                    <option value="inactivo" {% if request.GET.estado == 'inactivo' %}selected{% endif %}>Inactivo</option>
                    <option value="vacaciones" {% if request.GET.estado == 'vacaciones' %}selected{% endif %}>Vacaciones</option>
                    <option value="incapacidad" {% if request.GET.estado == 'incapacidad' %}selected{% endif %}>Incapacidad</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Cargo</label>
                <input type="text" name="cargo" class="form-control" placeholder="Cargo..."
                       value="{{ request.GET.cargo }}">
            </div>
            <div class="col-md-3 d-flex gap-2">
                <button type="submit" class="btn-primary-custom w-100">
                    <i class="bi bi-search"></i> Buscar
                </button>
                <a href="{% url 'talento_humano:lista_empleados' %}" class="btn-outline w-100">
                    <i class="bi bi-arrow-repeat"></i> Limpiar
                </a>
            </div>
        </div>
    </form>

    <!-- TABLA -->
    <div class="table-container">
        <table class="table-modern">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Empleado</th>
                    <th>Cargo</th>
                    <th>√Årea</th>
                    <th>Estado</th>
                    <th style="text-align: center;">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for empleado in empleados %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td class="text-start">
                        <div style="display:flex;align-items:center;gap:10px;">
                            {% if empleado.foto %}
                                <img src="{{ empleado.foto.url }}" alt="{{ empleado.get_nombre_completo }}" style="width:40px;height:40px;border-radius:6px;object-fit:cover;">
                            {% else %}
                                <div class="avatar-initials">{{ empleado.primer_nombre.0 }}{{ empleado.primer_apellido.0 }}</div>
                            {% endif %}
                            <div>
                                <strong>{{ empleado.get_nombre_completo }}</strong><br>
                                <small class="text-muted">{{ empleado.email_corporativo|default:"Sin email" }}</small>
                            </div>
                        </div>
                    </td>
                    <td>{{ empleado.cargo }}</td>
                    <td>{{ empleado.area }}</td>
                    <td>
                        <span class="badge 
                            {% if empleado.estado == 'activo' %}badge-success
                            {% elif empleado.estado == 'inactivo' %}badge-danger
                            {% elif empleado.estado == 'vacaciones' %}badge-warning
                            {% else %}badge-secondary{% endif %}">
                            {{ empleado.get_estado_display }}
                        </span>
                    </td>
                    <td>
                        <div class="d-flex justify-content-center gap-1">
                            <a href="{% url 'talento_humano:detalle_empleado' empleado.id %}" 
                               class="btn btn-sm" 
                               style="background:#17a2b8;color:white;border-radius:4px;padding:5px 10px;"
                               title="Ver perfil">
                                <i class="bi bi-eye-fill"></i>
                            </a>
                            <a href="{% url 'talento_humano:editar_empleado' empleado.id %}" 
                               class="btn btn-sm" 
                               style="background:#ffc107;color:#000;border-radius:4px;padding:5px 10px;"
                               title="Editar">
                                <i class="bi bi-pencil-fill"></i>
                            </a>
                            <a href="{% url 'talento_humano:eliminar_empleado' empleado.id %}" 
                               class="btn btn-sm" 
                               style="background:#dc3545;color:white;border-radius:4px;padding:5px 10px;"
                               title="Eliminar"
                               onclick="return confirm('¬øEst√° seguro de eliminar a {{ empleado.get_nombre_completo }}?');">
                                <i class="bi bi-trash-fill"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-4">
                        <i class="bi bi-inbox" style="font-size:2rem;color:#ccc;"></i><br>
                        <small>No hay empleados registrados</small>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- PAGINACI√ìN -->
    {% if empleados.has_other_pages %}
    <div class="mt-3 text-center">
        <ul class="pagination justify-content-center">
            {% if empleados.has_previous %}
            <li class="page-item"><a class="page-link" href="?page=1">Primera</a></li>
            <li class="page-item"><a class="page-link" href="?page={{ empleados.previous_page_number }}">Anterior</a></li>
            {% endif %}
            <li class="page-item active">
                <span class="page-link">{{ empleados.number }} / {{ empleados.paginator.num_pages }}</span>
            </li>
            {% if empleados.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ empleados.next_page_number }}">Siguiente</a></li>
            <li class="page-item"><a class="page-link" href="?page={{ empleados.paginator.num_pages }}">√öltima</a></li>
            {% endif %}
        </ul>
    </div>
    {% endif %}

</div>
{% endblock %}