{% extends 'base.html' %}
{% load static %}

{% block title %}Perfil de {{ empleado.get_nombre_completo }}{% endblock %}

{% block content %}
<div class="container mb-5">

    <!-- ENCABEZADO -->
    <div class="d-flex justify-content-between align-items-center flex-wrap mb-4">
        <h1 class="section-title">
            <i class="bi bi-person-badge"></i> {{ empleado.get_nombre_completo }}
        </h1>
        <div class="d-flex flex-wrap gap-2">
            <a href="{% url 'talento_humano:editar_empleado' empleado.pk %}" class="btn-amarillo">
                <i class="bi bi-pencil-square"></i> Editar
            </a>
            <a href="{% url 'talento_humano:generar_certificacion_empleado' empleado.pk %}" class="btn-outline">
                <i class="bi bi-file-earmark-pdf"></i> Certificación
            </a>
            <a href="{% url 'talento_humano:lista_empleados' %}" class="btn-volver">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
        </div>
    </div>

    <!-- CABECERA DE PERFIL -->
    <div class="card mb-4 p-4 d-flex flex-wrap flex-lg-nowrap gap-4 align-items-center">
        {% if empleado.foto %}
            <img src="{{ empleado.foto.url }}" alt="{{ empleado.get_nombre_completo }}" class="rounded shadow-sm" style="width:140px;height:140px;object-fit:cover;">
        {% else %}
            <div class="rounded-circle d-flex align-items-center justify-content-center bg-secondary text-white fw-bold shadow-sm" style="width:140px;height:140px;font-size:2rem;">
                {{ empleado.primer_nombre.0 }}{{ empleado.primer_apellido.0 }}
            </div>
        {% endif %}
        <div class="flex-grow-1">
            <h2 class="fw-bold mb-1">{{ empleado.get_nombre_completo }}</h2>
            <p class="text-muted mb-2">{{ empleado.cargo }} — {{ empleado.area }}</p>
            <div class="d-flex flex-wrap gap-2">
                {% if empleado.sede %}
                    <span class="badge bg-light text-dark border"><i class="bi bi-building"></i> {{ empleado.sede }}</span>
                {% endif %}
                <span class="badge bg-light text-dark border"><i class="bi bi-person-vcard"></i> {{ empleado.numero_documento }}</span>
                <span class="badge {% if empleado.estado == 'activo' %}bg-success{% else %}bg-secondary{% endif %}">
                    {{ empleado.get_estado_display }}
                </span>
            </div>
        </div>
    </div>

    <!-- GRID DE INFORMACIÓN -->
    <div class="row g-4">
        <!-- COLUMNA 1 -->
        <div class="col-lg-4">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-light fw-bold"><i class="bi bi-person"></i> Información Personal</div>
                <div class="card-body small">
                    <p><strong>Fecha de Nacimiento:</strong> {{ empleado.fecha_nacimiento|date:"d/m/Y"|default:"N/A" }}</p>
                    <p><strong>Edad:</strong> {% if empleado.fecha_nacimiento %}{{ empleado.fecha_nacimiento|timesince }}{% else %}N/A{% endif %}</p>
                    <p><strong>Género:</strong> {{ empleado.get_genero_display|default:"N/A" }}</p>
                    <p><strong>Estado Civil:</strong> {{ empleado.get_estado_civil_display|default:"N/A" }}</p>
                    <p><strong>Lugar de Expedición:</strong> {{ empleado.lugar_expedicion|default:"N/A" }}</p>
                </div>
            </div>

            <div class="card shadow-sm border-0 mt-3">
                <div class="card-header bg-light fw-bold"><i class="bi bi-telephone"></i> Contacto</div>
                <div class="card-body small">
                    <p><strong>Celular:</strong> <a href="tel:{{ empleado.celular }}">{{ empleado.celular|default:"N/A" }}</a></p>
                    {% if empleado.telefono_fijo %}
                        <p><strong>Teléfono Fijo:</strong> {{ empleado.telefono_fijo }}</p>
                    {% endif %}
                    <p><strong>Email Personal:</strong> <a href="mailto:{{ empleado.email_personal }}">{{ empleado.email_personal|default:"N/A" }}</a></p>
                    <p><strong>Email Corporativo:</strong> <a href="mailto:{{ empleado.email_corporativo }}">{{ empleado.email_corporativo|default:"N/A" }}</a></p>
                    <p><strong>Dirección:</strong> {{ empleado.direccion|default:"N/A" }}</p>
                    <p><strong>Ciudad:</strong> {{ empleado.ciudad|default:"N/A" }}</p>
                    {% if empleado.barrio %}<p><strong>Barrio:</strong> {{ empleado.barrio }}</p>{% endif %}
                </div>
            </div>

            {% if empleado.contacto_emergencia_nombre %}
            <div class="card shadow-sm border-0 mt-3">
                <div class="card-header bg-light fw-bold text-danger"><i class="bi bi-exclamation-triangle"></i> Contacto de Emergencia</div>
                <div class="card-body small">
                    <p><strong>Nombre:</strong> {{ empleado.contacto_emergencia_nombre }}</p>
                    <p><strong>Parentesco:</strong> {{ empleado.contacto_emergencia_parentesco }}</p>
                    <p><strong>Teléfono:</strong> <a href="tel:{{ empleado.contacto_emergencia_telefono }}">{{ empleado.contacto_emergencia_telefono }}</a></p>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- COLUMNA 2 -->
        <div class="col-lg-4">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-light fw-bold"><i class="bi bi-briefcase"></i> Información Laboral</div>
                <div class="card-body small">
                    <p><strong>Fecha de Ingreso:</strong> {{ empleado.fecha_ingreso|date:"d/m/Y" }}</p>
                    <p><strong>Antigüedad:</strong> {{ antiguedad.texto }}</p>
                    <p><strong>Cargo:</strong> {{ empleado.cargo }}</p>
                    <p><strong>Área:</strong> {{ empleado.area }}</p>
                    {% if empleado.jefe_inmediato %}
                        <p><strong>Jefe Inmediato:</strong>
                            <a href="{% url 'talento_humano:detalle_empleado' empleado.jefe_inmediato.pk %}">
                                {{ empleado.jefe_inmediato.get_nombre_completo }}
                            </a>
                        </p>
                    {% endif %}
                    {% if empleado.sede %}
                        <p><strong>Sede:</strong> {{ empleado.sede }}</p>
                    {% endif %}
                </div>
            </div>

            <div class="card shadow-sm border-0 mt-3">
                <div class="card-header bg-light fw-bold"><i class="bi bi-cash"></i> Información Salarial</div>
                <div class="card-body small">
                    <p><strong>Salario Básico:</strong> ${{ empleado.salario_basico|floatformat:0 }}</p>
                    <p><strong>Auxilio Transporte:</strong> {% if empleado.aplica_auxilio_transporte %}<span class="text-success">Sí</span>{% else %}No{% endif %}</p>
                    <p><strong>Salario Integral:</strong> {% if empleado.salario_integral %}<span class="text-primary">Sí</span>{% else %}No{% endif %}</p>
                </div>
            </div>

            <div class="card shadow-sm border-0 mt-3">
                <div class="card-header bg-light fw-bold"><i class="bi bi-shield-check"></i> Seguridad Social</div>
                <div class="card-body small">
                    <p><strong>EPS:</strong> {{ empleado.eps.nombre|default:"No asignada" }}</p>
                    <p><strong>AFP:</strong> {{ empleado.afp.nombre|default:"No asignada" }}</p>
                    <p><strong>ARL:</strong> {{ empleado.arl.nombre|default:"No asignada" }}</p>
                    <p><strong>Caja Compensación:</strong> {{ empleado.caja_compensacion.nombre|default:"No asignada" }}</p>
                </div>
            </div>
        </div>

        <!-- COLUMNA 3 -->
        <div class="col-lg-4">
            {% if contrato_actual %}
            <div class="card shadow-sm border-0">
                <div class="card-header bg-light fw-bold"><i class="bi bi-file-text"></i> Contrato Actual</div>
                <div class="card-body small">
                    <p><strong>Tipo:</strong> {{ contrato_actual.get_tipo_display }}</p>
                    <p><strong>No.:</strong> {{ contrato_actual.numero_contrato }}</p>
                    <p><strong>Inicio:</strong> {{ contrato_actual.fecha_inicio|date:"d/m/Y" }}</p>
                    {% if contrato_actual.fecha_fin %}
                        <p><strong>Fin:</strong> {{ contrato_actual.fecha_fin|date:"d/m/Y" }}</p>
                        <p><strong>Días Restantes:</strong> {{ contrato_actual.dias_para_vencer }}</p>
                    {% endif %}
                    <a href="{% url 'talento_humano:lista_contratos' %}?empleado={{ empleado.pk }}" class="btn-outline w-100 mt-2">
                        <i class="bi bi-journal-text"></i> Ver Historial
                    </a>
                </div>
            </div>
            {% endif %}

            <div class="card shadow-sm border-0 mt-3">
                <div class="card-header bg-light fw-bold"><i class="bi bi-umbrella"></i> Vacaciones</div>
                <div class="card-body small text-center">
                    <h1 class="text-success fw-bold mb-0">{{ dias_vacaciones_disponibles }}</h1>
                    <p class="text-muted mb-3">Días Disponibles</p>
                    {% if vacaciones_recientes %}
                        <ul class="list-unstyled text-start">
                            {% for vacacion in vacaciones_recientes %}
                                <li class="border-bottom py-2">
                                    <i class="bi bi-calendar3"></i> {{ vacacion.fecha_inicio|date:"d/m/Y" }} - {{ vacacion.fecha_fin|date:"d/m/Y" }}
                                    {% if vacacion.aprobada %}
                                        <span class="badge bg-success ms-2">Aprobada</span>
                                    {% else %}
                                        <span class="badge bg-warning text-dark ms-2">Pendiente</span>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>

            {% if capacitaciones %}
            <div class="card shadow-sm border-0 mt-3">
                <div class="card-header bg-light fw-bold"><i class="bi bi-mortarboard"></i> Capacitaciones Recientes</div>
                <div class="card-body small">
                    <ul class="list-unstyled mb-0">
                        {% for inscripcion in capacitaciones %}
                            <li class="border-bottom py-2">
                                <i class="bi bi-calendar3"></i> {{ inscripcion.capacitacion.fecha_programada|date:"d/m/Y" }} — {{ inscripcion.capacitacion.nombre }}
                                {% if inscripcion.asistio %}<span class="badge bg-success ms-1">Asistió</span>{% endif %}
                                {% if inscripcion.calificacion %}<span class="badge bg-info text-dark ms-1"><i class="bi bi-star-fill"></i> {{ inscripcion.calificacion }}/5</span>{% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}

            {% if evaluaciones %}
            <div class="card shadow-sm border-0 mt-3">
                <div class="card-header bg-light fw-bold"><i class="bi bi-graph-up"></i> Evaluaciones de Desempeño</div>
                <div class="card-body small">
                    <ul class="list-unstyled mb-0">
                        {% for evaluacion in evaluaciones %}
                            <li class="border-bottom py-2">
                                <i class="bi bi-calendar3"></i> {{ evaluacion.periodo }} — {{ evaluacion.fecha_evaluacion|date:"d/m/Y" }}
                                <span class="badge bg-primary ms-2"><i class="bi bi-award-fill"></i> {{ evaluacion.calificacion_promedio }}/5</span>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    {% if empleado.observaciones %}
    <div class="card shadow-sm border-0 mt-4">
        <div class="card-header bg-light fw-bold"><i class="bi bi-chat-left-text"></i> Observaciones</div>
        <div class="card-body">{{ empleado.observaciones }}</div>
    </div>
    {% endif %}

</div>
{% endblock %}
