{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">

    <!-- Botón volver -->
    <div class="mb-3">
        <a href="{% url 'administrativa:inventario:index_inventario' %}" class="btn-amarillo">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
    </div>

    <!-- Título -->
    <h2 class="section-title">
        <i class="fas fa-screwdriver-wrench"></i> Inventario de Maquinaria
    </h2>

    <!-- Barra de búsqueda y acciones -->
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap" style="gap:12px;">
        <!-- Buscador -->
        <div class="input-group" style="max-width: 320px;">
            <span class="input-group-text bg-white">
                <i class="fas fa-search text-muted"></i>
            </span>
            <input type="text" id="buscador" class="form-control" placeholder="Buscar maquinaria...">
        </div>

        <!-- Botón nueva maquinaria -->
        <a href="{% url 'administrativa:inventario:nueva_maquinaria' %}" class="btn-amarillo">
            <i class="fas fa-plus"></i> Registrar Maquinaria
        </a>
    </div>

    <!-- Tabla -->
    <div class="table-container">
        <table class="table-modern table-yellow" id="tabla-maquinaria">
            <thead>
                <tr>
                    <th>Serial</th>
                    <th>Nombre</th>
                    <th>Marca</th>
                    <th>Fecha de Compra</th>
                    <th>Tiempo de Uso</th>
                    <th>Cantidad</th>
                    <th>Responsable</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for m in maquinas %}
                    <tr>
                        <td>{{ m.serial }}</td>
                        <td>{{ m.nombre }}</td>
                        <td>{{ m.marca }}</td>
                        <td>{{ m.fecha_compra|date:"d/m/Y" }}</td>
                        <td>
                            <span class="badge bg-info">
                                <i class="fas fa-clock"></i> {{ m.tiempo_uso }}
                            </span>
                        </td>
                        <td>{{ m.cantidad }}</td>
                        <td>{{ m.responsable }}</td>
                        <td class="text-center">
                            <!-- 🆕 BOTÓN DE MANUAL -->
                            {% if m.manual %}
                                <a href="{{ m.manual.url }}" 
                                   target="_blank" 
                                   class="btn btn-sm me-1" 
                                   title="Ver Manual"
                                   style="background: #8b5cf6; color: white; border: none; padding: 6px 10px; border-radius: 6px;">
                                    <i class="fas fa-book"></i>
                                </a>
                            {% else %}
                                <button class="btn btn-sm me-1" 
                                        disabled 
                                        title="Sin manual"
                                        style="background: #e5e7eb; color: #9ca3af; cursor: not-allowed; border: none; padding: 6px 10px; border-radius: 6px;">
                                    <i class="fas fa-book"></i>
                                </button>
                            {% endif %}

                            <!-- Botón Editar -->
                            <a href="{% url 'administrativa:inventario:editar_maquinaria' m.id %}" 
                               class="btn-icon edit" 
                               title="Editar">
                                <i class="fas fa-pencil-alt"></i>
                            </a>

                            <!-- Botón Eliminar -->
                            <a href="{% url 'administrativa:inventario:eliminar_maquinaria' m.id %}" 
                               class="btn-icon delete" 
                               title="Eliminar"
                               onclick="return confirm('¿Seguro que deseas eliminar esta máquina?')">
                                <i class="fas fa-trash"></i>
                            </a>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="8" class="text-center">No hay maquinaria registrada.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Script buscador -->
<script>
document.getElementById("buscador").addEventListener("keyup", function() {
    let value = this.value.toLowerCase();
    document.querySelectorAll("#tabla-maquinaria tbody tr").forEach(function(row) {
        row.style.display = row.textContent.toLowerCase().includes(value) ? "" : "none";
    });
});
</script>
{% endblock %}